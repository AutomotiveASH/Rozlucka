<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rozlučka Lukáše Korce - Úkoly</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      font-size: 2em;
      color: #222;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      color: #000;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }
    input, textarea, button, select {
      padding: 10px;
      margin-top: 5px;
      width: 100%;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      background-color: #0057e7;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0041b3;
    }
    .sent {
      background: #d4edda;
      color: #155724;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }
    .done {
      background-color: #d0f0c0;
    }
    .never {
      background-color: #f8d7da;
    }
  </style>
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("znWE4gvRGwEhyRPli"); 
    })();
  </script>
</head>
<body>
  <h1>Rozlučka Lukáše Korce – Úkoly</h1>

  <form id="taskForm">
    <label>Název úkolu:</label>
    <input type="text" id="task" required>

    <label>Odpovědná osoba:</label>
    <select id="responsible" required>
      <option value="">-- vyber osobu --</option>
      <option value="Adam">Adam</option>
      <option value="Adrian">Adrian</option>
      <option value="Dominik">Dominik</option>
      <option value="Pehe">Pehe</option>
      <option value="Vlasta">Vlasta</option>
      <option value="Pepa Janota">Pepa Janota</option>
      <option value="Pepa Vlk">Pepa Vlk</option>
      <option value="Tomáš Záky">Tomáš Záky</option>
      <option value="Tomáš Beránek">Tomáš Beránek</option>
    </select>

    <label>Email odpovědné osoby:</label>
    <input type="email" id="responsibleEmail" required>

    <label>Deadline:</label>
    <input type="date" id="deadline" required>

    <label>Poznámka:</label>
    <textarea id="note"></textarea>

    <button type="submit">Přidat úkol a odeslat upozornění</button>
    <div id="successMsg" class="sent" style="display:none;">Upozornění bylo odesláno!</div>
  </form>

  <table>
    <thead>
      <tr>
        <th>Úkol</th>
        <th>Odpovědný</th>
        <th>Deadline</th>
        <th>Poznámka</th>
        <th>Stav</th>
        <th>Akce</th>
      </tr>
    </thead>
    <tbody id="taskTable"></tbody>
  </table>

  <script>
    const form = document.getElementById('taskForm');
    const table = document.getElementById('taskTable');
    const successMsg = document.getElementById('successMsg');
    const taskList = [];

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const task = document.getElementById('task').value;
      const responsible = document.getElementById('responsible').value;
      const email = document.getElementById('responsibleEmail').value;
      const deadline = document.getElementById('deadline').value;
      const note = document.getElementById('note').value;

      const row = document.createElement('tr');
      const index = taskList.length;
      row.innerHTML = `
        <td contenteditable="true">${task}</td>
        <td>${responsible}</td>
        <td contenteditable="true">${deadline}</td>
        <td contenteditable="true">${note}</td>
        <td>
          <label><input type="radio" name="status${index}" onchange="setStatus(this, 'done')"> Hotovo</label><br>
          <label><input type="radio" name="status${index}" onchange="setStatus(this, 'never')"> NEBUDE</label>
        </td>
        <td>
          <button onclick="editTask(this)">Editovat</button>
          <button onclick="deleteTask(this)">Smazat</button>
        </td>
      `;
      table.appendChild(row);

      taskList.push({ task, responsible, email, deadline, note });

      const params = {
        task: task,
        deadline: deadline,
        note: note,
        to_email: email
      };

      emailjs.send("service_sxmoncq", "template_imcl3df", params)
        .then(function() {
          successMsg.style.display = 'block';
          form.reset();
          setTimeout(() => successMsg.style.display = 'none', 3000);
        }, function(error) {
          alert("Chyba při odesílání: " + JSON.stringify(error));
        });
    });

    function setStatus(radio, status) {
      const row = radio.closest('tr');
      row.classList.remove('done', 'never');
      if (status === 'done') row.classList.add('done');
      if (status === 'never') row.classList.add('never');
    }

    function deleteTask(button) {
      const row = button.closest('tr');
      row.remove();
    }

    function editTask(button) {
      const row = button.closest('tr');
      const cells = row.querySelectorAll('td');
      cells.forEach((cell, index) => {
        if (index < 4) cell.contentEditable = true;
      });
      row.style.backgroundColor = '#fff3cd';
    }

    setInterval(() => {
      const now = new Date();
      if (now.getHours() === 11 && now.getMinutes() === 0) {
        taskList.forEach(t => {
          const params = {
            task: t.task,
            deadline: t.deadline,
            note: t.note,
            to_email: t.email
          };
          emailjs.send("service_sxmoncq", "template_imcl3df", params);
        });
      }
    }, 60000);
  </script>
</body>
</html>